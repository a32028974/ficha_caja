<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Emitir Comprobante ‚Ä¢ √ìptica Cristal</title>
<link rel="icon" href="logo.png">
<style>
  :root{--bg:#f6f7f9;--panel:#fff;--line:#e5e7eb;--muted:#667085;--green:#16a34a;--red:#dc2626;--blue:#2563eb;}
  *{box-sizing:border-box;font-family:system-ui,Arial,sans-serif}
  body{margin:0;background:var(--bg);color:#111}
  header{display:flex;align-items:center;gap:12px;padding:10px 14px;background:#fff;border-bottom:1px solid var(--line);position:sticky;top:0;z-index:5}
  header img{height:40px}
  .title{font-weight:700;font-size:20px;margin-right:auto}
  .pill{border:1px solid var(--line);border-radius:999px;background:#fff;padding:6px 10px;font-size:13px}
  .wrap{max-width:960px;margin:16px auto;padding:0 14px 60px}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:14px;margin:12px 0}
  h3{margin:6px 0 10px;font-size:16px}
  label{display:block;font-size:12px;color:var(--muted);margin:6px 0 4px}
  input,select,textarea{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:10px;font-size:15px}
  .row5{display:grid;grid-template-columns:150px 1fr 160px 140px 1fr;gap:10px}
  .btn{padding:10px 14px;border:1px solid #d1d5db;border-radius:10px;background:#fff;cursor:pointer}
  .btn.green{background:var(--green);color:#fff;border-color:var(--green)}
  .btn.red{background:var(--red);color:#fff;border-color:var(--red)}
  .muted{color:var(--muted)}
  .ok{color:var(--green)} .err{color:var(--red)}
  /* Login modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:50}
  .hidden{display:none!important}
  .modal .inner{width:100%;max-width:420px;background:#fff;border:1px solid var(--line);border-radius:14px;padding:18px}
</style>
</head>
<body>
<header>
  <img src="logo.png" alt="√ìptica Cristal">
  <div class="title">Emitir Comprobante</div>
  <div class="pill">üìÖ <span id="hoy"></span></div>
  <div class="pill">üë§ <b id="empName">‚Äî</b></div>
  <button class="btn" id="btnCambiar">Cambiar empleado</button>
</header>

<div class="wrap">
  <section class="card">
    <h3>Conceptos a facturar</h3>
    <div class="row5">
      <div>
        <label>C√≥digo / CB</label>
        <input id="codigo" placeholder="Escane√° o escrib√≠ y Enter">
      </div>
      <div>
        <label>Descripci√≥n</label>
        <input id="desc" placeholder="Se completa desde Stock (editable)">
      </div>
      <div>
        <label>Rubro</label>
        <select id="rubro" required>
          <option>Receta</option>
          <option>Lentes de contacto</option>
          <option>L√≠quidos LC</option>
          <option>Reparaciones y varios</option>
          <option>Sol</option>
          <option>Fotos y pilas</option>
        </select>
      </div>
      <div>
        <label>Precio</label>
        <input type="number" id="precio" inputmode="decimal" placeholder="0">
      </div>
      <div>
        <label>Forma de pago</label>
        <select id="fdp">
          <option>Efectivo</option>
          <option>MercadoPago</option>
          <option>Transferencia</option>
          <option>Tarjeta</option>
        </select>
      </div>
    </div>

    <div style="margin-top:10px">
      <label>Detalle (opcional)</label>
      <input id="detalle" placeholder="Apellido + N¬∞ sobre, '1 caja Oasys', '4 fotos 4x4', etc.">
    </div>

    <p id="msg" class="muted" style="margin-top:8px">Tip: Enter en ‚ÄúC√≥digo/CB‚Äù busca en Stock. Enter en ‚ÄúPrecio‚Äù guarda la venta.</p>
  </section>

  <section class="card">
    <h3>√öltimas ventas (3)</h3>
    <div id="ultimas" class="muted">Sin ventas a√∫n.</div>
  </section>
</div>

<!-- Login -->
<div class="modal" id="login">
  <div class="inner">
    <h3>Ingresar empleado</h3>
    <p class="muted">Escrib√≠ tu <b>c√≥digo</b> (C, R, L, JU, JI, S...). No hay clave.</p>
    <label>C√≥digo</label>
    <input id="empCode" placeholder="JU">
    <div style="display:flex;justify-content:flex-end;margin-top:10px">
      <button class="btn" id="btnLogin">Entrar</button>
    </div>
    <p id="loginMsg" class="muted"></p>
  </div>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbz3NN9fyuvU0-qaMZM6am7sxopKLtKEQF59kKKeJWeEj7a11UBECFpKzlFRLR8c8qOQoA/exec';

const qs = s=>document.querySelector(s);
const money = n => new Intl.NumberFormat('es-AR',{style:'currency',currency:'ARS',maximumFractionDigits:0}).format(Number(n||0));

// ===== API =====
async function apiGet(params){
  const r = await fetch(API_URL + '?' + new URLSearchParams(params).toString());
  return r.json();
}
async function apiPost(payload){
  const r = await fetch(API_URL, { method:'POST', body: JSON.stringify(payload) }); // sin Content-Type -> sin preflight CORS
  return r.json();
}

// ===== Login =====
function setEmp(emp){
  localStorage.setItem('OC_EMP_CODE', (emp.codigo+'').toUpperCase());
  localStorage.setItem('OC_EMP_NAME', emp.nombre);
  qs('#empName').
